<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smart Bus - Driver</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <style>
        body { margin:0; background:#111; color:white; font-family:sans-serif; text-align:center; transition:0.3s; }
        #box { margin-top:35vh; }
        h1 { font-size:3rem; }
    </style>
</head>
<body>
    <div id="box">
        <h1 id="msg">DRIVER ACTIVE</h1>
        <p id="sub">Broadcasting Location...</p>
    </div>
    <script>
        const client = new Paho.MQTT.Client("broker.hivemq.com", 8000, "d_" + Math.random());
        client.connect({useSSL: true, onSuccess: () => {
            client.subscribe("smart_bus_project/driver_alerts");
            navigator.geolocation.watchPosition(pos => {
                const data = JSON.stringify({lat: pos.coords.latitude, lon: pos.coords.longitude});
                client.send("smart_bus_project/bus_location", data);
            }, null, {enableHighAccuracy:true});
        }});

        client.onMessageArrived = (m) => {
            document.body.style.background = "red";
            document.getElementById('msg').innerText = "PASSENGER!";
            document.getElementById('sub').innerText = "Bus Requested: " + m.payloadString;
            window.speechSynthesis.speak(new SpeechSynthesisUtterance("Passenger request for bus " + m.payloadString));
            setTimeout(() => { 
                document.body.style.background = "#111"; 
                document.getElementById('msg').innerText = "DRIVER ACTIVE";
            }, 10000);
        };
    </script>
</body>
</html>
